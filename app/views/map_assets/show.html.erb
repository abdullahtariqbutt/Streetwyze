<div class="jumbotron">
  <h1 class="display-4">
    <%= @map_asset.name %>
  </h1>

  <p class="lead">
    <%= @map_asset.address %>
  </p>

  <hr class="my-4">

  <div class="row">
    <p class="pl-3">
      <strong>Category:</strong>
      <%= @map_asset.category %>
    </p>
    <p class="pl-3">
      <strong>Stuff Type:</strong>
      <%= @map_asset.stuff_type %>
    </p>
  </div>

  <div id="map_asset">
    <div id="rating_display" data-score="<%= @map_asset.rating %>"></div>
  </div>
</div>

<p>
  <strong>Description:</strong>
  <%= @map_asset.description %>
</p>

<!-- Image Dispaly Code -->
<div>
  <strong>Attachments:</strong>

  <% @map_asset.images.each do |img| %>

    <% if img.variable? %>
      <%= link_to image_tag(img.variant(resize: "400x400")), img %>
      <br>
    <% elsif img.previewable? %>
      <%= link_to image_tag(img.preview(resize: "400x400")), img %>
      <br>
    <% elsif img.image? %>
      <%= link_to image_tag(img, width:400), img %>
      <br>
    <% else %>
      <%= link_to image.filename , rails_blog_path %>
      <br>
    <% end %>

    <!-- Owner Check to allow Delete Option -->
    <% if user_signed_in? %>
      <% if @map_asset.user == current_user %>
        <%= link_to 'Remove', delete_image_map_asset_path(img.signed_id), class:"btn btn-primary"
                  method: :delete,
                  data: { confirm: 'Are you sure?' } %><br>
      <% end %>
    <% end %>
    <!-- End -->

  <% end %>
</div>
<!-- End -->
    
<br>

<%= link_to 'Edit', edit_map_asset_path(@map_asset), class:"btn btn-primary btn-lg" %> |
<%= link_to 'Back', map_assets_path, class:"btn btn-primary btn-lg" %>

<br><br>

<!-- User Signed in Requiredment to add Story -->
<% if user_signed_in? %>
  <%= link_to 'Add Story', new_map_asset_story_path(@map_asset), class: "btn btn-primary", data: { toggle: 'modal', target: '#new_story_modal', remote: true } %>
<% else %>
  <%= link_to 'Add Story', map_asset_path(@map_asset), class: "btn btn-primary"%>
<% end %>

<!-- Modal Code -->
<div class="modal fade" id="new_story_modal" tabindex="-1" aria-labelledby="StoryModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="new_story_modal_label">Add Story</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="new_story_form">
      </div>
    </div>
  </div>
</div>
<!-- End -->

<h1>Stories</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Address</th>
      <th>Category</th>
      <th>Rating</th>
      <th>Stuff type</th>
      <th>Description</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody id="stories_table">
    <% @stories.each do |story| %>
      <%= render 'shared/story_row', story: story %>
    <% end %>
  </tbody>
</table>
